# Node.js

## Node.js运行机制

![](https://raw.githubusercontent.com/KID-1912/Github-PicGo-Images/master/202411231234896.webp)

1. V8引擎解析JavaScript脚本
2. 解析后的代码，调用Node API
3. libuv库负责Node API的执行。它将不同的任务分配给不同的线程，形成一个Event Loop（事件循环），以异步的方式将任务的执行结果返回给V8引擎
4. V8引擎再将结果返回给用户

Node.js的单线程指的是主线程是“单线程”，由主要线程去按照编码顺序一步步执行程序代码，假如遇到同步代码阻塞，主线程被占用，后续的程序代码执行就会被卡住。

单线程为什么能支持高并发？为什么一个单线程的效率可以这么高，同时处理数万级的并发而不会造成阻塞呢？

### Nodejs事件循环/事件驱动/线程池

基于 libuv 提供的事件循环实现

**node.js和浏览器js事件循环异同**

- 都是基于 执行栈 + 事件队列 的事件循环机制
- 浏览器只根据任务队列类型（宏任务/微任务）确定的执行顺序，nodejs是分多阶段的，还存在阶段顺序
- 事件循环处理工作不同，浏览器执行js逻辑处理，nodejs分配线程处理 I/O 密集型任务
